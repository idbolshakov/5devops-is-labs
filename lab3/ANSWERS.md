# Ответы на теоретические вопросы лабораторной работы №3

## Часть 1

### 1.1 Что записано в первом секторе главной загрузочной записи MBR ?
Первый сектор главной загрузочной записи (MBR) содержит информацию о четырех разделах диска, ссылку на загрузчик и сигнатуру 0x55AAh. Если загрузчик отсутствует, выдается сообщение об ошибке. Также в MBR записывается название текущей файловой системы, например, FAT32 или NTFS.

---

### 1.2 Функциональное назначение MBR и GPT?
MBR (Master Boot Record) используется для загрузки операционной системы и хранит таблицу разделов диска. Она применялась до появления UEFI и GPT. GPT (GUID Partition Table), часть стандарта EFI, заменяет MBR и предоставляет улучшенные функции, включая поддержку большего количества разделов и современные методы адресации. GPT также обеспечивает защиту и совместимость с MBR.

---

### 1.3 Структура GPT.
GPT состоит из нескольких ключевых компонентов:

1. Заголовок GPT — расположен сразу после защитной MBR и содержит метаданные таблицы разделов, такие как смещение начала таблицы разделов и количество записей.
   
2. Таблица разделов — массив записей, каждая из которых описывает один раздел диска. В каждой записи хранится уникальный GUID раздела, начальное и конечное LBA, а также флаги и имя раздела.

3. Резервная копия заголовка GPT — находится в конце диска и дублирует основную структуру для обеспечения целостности данных.

4. Защитная MBR — располагается в самом начале диска и предотвращает случайную перезапись GPT старыми утилитами, которые поддерживают только MBR.

---

### 1.4 Какое максимальное количество первичных разделов можно создать при использовании таблицы разделов MBR ?
При использовании MBR можно создать максимум 4 первичных раздела.

---

### 1.5 Какое максимальное количество первичных разделов можно создать при использовании таблицы разделов GPT ?
GPT поддерживает до 128 разделов и диски размером более 2 ТБ.

---

### 1.6 Как сохранить информацию о структуре MBR ?
Для сохранения информации о структуре MBR можно использовать команду dd:

```
sudo dd if=/dev/sda of=mbr_backup.bin bs=512 count=1
```

Эта команда создаст резервную копию первых 512 байтов (размер одного сектора) устройства /dev/sda, содержащего MBR, в файл mbr_backup.bin.

---

### 1.7 Как создать 10 разделов c файловой системой ext3 на диске в таблице разделов MBR ?
Создать 10 первичных разделов с файловой системой ext3 в рамках MBR невозможно, поскольку MBR поддерживает только 4 первичных раздела. Чтобы обойти это ограничение, можно использовать один из первичных разделов как расширенный, внутри которого создаётся до 11 логических разделов.

---

### 1.8 Как стереть код загрузчика в MBR ?
Чтобы стереть код загрузчика в MBR, можно использовать команду `dd`:

```
# Замените /dev/sdX на соответствующий дисковый накопитель.
sudo dd if=/dev/zero of=/dev/sdX bs=446 count=1
```

---

### 1.9 Как можно смонтировать раздел диска с файловой системой в режиме только для чтения?
Для монтирования раздела в режиме только для чтения используйте параметр ro:

```
# /dev/sdXN   — путь к устройству
# /mountpoint — точка монтирования
mount -o ro /dev/sdXN /mountpoint
```

---

### 1.10 Как можно осуществить восстановление GPT разделов в случае сбоев?
Для восстановления GPT разделов можно воспользоваться утилитой gdisk:

```
# Замените /dev/sdX на соответствующий дисковый накопитель.
sudo gdisk /dev/sdX
```
1. Выберите команду `b` для резервного копирования основной таблицы разделов.

2. Выберите команду `r` для восстановления.

3. Используйте команду `l` для поиска потерянных разделов.

4. Примените найденные разделы командой `w`.

Это поможет восстановить GPT-разделы из резервной копии.

---

## Часть 2

### 2.1 С помощью какой из программ, используемых в этой лабораторной работе, можно восстановить таблицу разделов?

* `dd`       - если есть резервная копия
* `testdisk` - для более сложных случаев

---

### 2.2 Какие файловые системы поддерживает PhotoRec?
PhotoRec поддерживает следующие файловые системы: FAT, NTFS, ext2, ext3 и ext4.

---

### 2.3 Какие форматы поддерживает PhotoRec?
PhotoRec поддерживает множество форматов файлов, включая изображения (JPEG), аудиофайлы (MP3), документы (Microsoft Office, PDF, HTML) и архивы (ZIP)

---

### 2.4 Все ли данные удалось восстановить, если нет, постарайтесь прокомментировать почему.

В моем случае удалось восстановить не все файлы.

Причины, почему PhotoRec не всегда восстанавливает все файлы:

1. Перезапись данных: Если после удаления файла были записаны новые данные, старые могут быть частично или полностью уничтожены.
   
2. Фрагментация: Файлы могут быть фрагментированы, и PhotoRec не всегда способен собрать их корректно.

3. Повреждение файловой системы: Серьезные повреждения могут сделать невозможным точное определение расположения файлов.

4. Ограниченная поддержка форматов: Некоторые специфичные форматы могут не поддерживаться программой.

5. Размер кластера: Чем больше размер кластера, тем больше вероятность потери части данных при фрагментации.

6. Тип носителя: Flash-накопители и SSD могут использовать технологии TRIM, затрудняя восстановление данных.

7. Форматирование: Быстрое форматирование может оставить данные на месте, но полное форматирование часто делает восстановление невозможным.

8. Алгоритмы сжатия и шифрования: Используемые алгоритмы могут усложнить процесс восстановления.

9. Физическое повреждение: Повреждения самого носителя могут привести к потере данных.

10. Устаревшие версии программы: Более новые версии могут поддерживать дополнительные форматы и иметь улучшения в алгоритмах восстановления.

---

